@startuml

hide empty description

[*] --> Selected : 使用者選擇檔案

state "已選擇\n(Selected)" as Selected <<ready>>
Selected --> Uploading : POST /api/system/uploadfile_entity/file

state "上傳中\n(Uploading)" as Uploading <<inprogress>>
Uploading --> Storing : 上傳至 MinIO 成功
Uploading --> Failed : 上傳失敗

state "儲存中\n(Storing)" as Storing <<inprogress>>
Storing --> Stored : INSERT uploadfile_entity 成功
Storing --> Failed : 寫入 DB 失敗

state "上傳失敗\n(Failed)" as Failed <<error>>
Failed --> Selected : 重新選擇檔案

state "已儲存\n(Stored)" as Stored <<stored>>

Stored --> Generating : GET /api/system/document/{document_id}
state "生成 URL 中\n(Generating)" as Generating <<inprogress>>
Generating --> Available : 取得 Record 並生成預簽名 URL

state "可預覽\n(Available)" as Available <<ready>>
Available --> Previewing : 使用者開啟 URL

state "預覽中\n(Previewing)" as Previewing <<preview>>
Previewing --> Stored : 關閉預覽頁

@enduml
