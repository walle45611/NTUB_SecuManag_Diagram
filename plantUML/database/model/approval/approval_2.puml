@startuml
' skinparam linetype ortho
left to right direction

entity "approval" as APV {
    name                    : string    {not null}
    description             : string    {nullable}
    related_object_category : enum      {not null, default: document, index}
    action_type             : enum      {default: create, index}
    final_status            : enum      {not null, default: pending}
    signers                 : jsonb     {not null}
    delay_count             : integer   {default: 0}
    created_time            : datetime  {not null, default: now() }
    --
    id                      : UUID      <<PK>>  {not null, default: uuid_generate_v4()}
    uploadfile_entity_id    : UUID      <<FK>>  {not null, references uploadfile_entity(id)}
    related_object_id       : UUID      <<FK>>  {not null, index, references announcement(id) when related_object_category='announcement'}
}

entity "asset" as AST {
    name                  : string    {not null}
    description           : string    {not null}
    value                 : float     {not null}
    custom_fields         : json      {nullable}
    created_time          : datetime  {not null, default: now() }
    version_group_id      : string    {not null}
    is_current            : bool      {not null, default: false}
    --
    id                    : UUID      <<PK>>  {not null, default: uuid_generate_v4()}
    parent_id             : UUID      <<FK>>  {references asset(id)}
    asset_category_id     : UUID      <<FK>>  {not null, references asset_category(id)}
}
AST ||--o{ AST : children
AST ||--o{ APV : approvals

entity "isms_setting" as ISMSS {
    name                            : string    {not null}
    description                     : string    {not null}
    calculation_formula             : string    {nullable}
    calculation_formula_description : string    {nullable}
    custom_fields                   : json      {nullable}
    risk_notification_users         : list      {nullable}
    threshold_min                   : float     {not null}
    threshold_max                   : float     {not null}
    created_time                    : datetime  {not null, default: now() }
    version_group_id                : string    {not null}
    is_current                      : bool      {not null, default: false}
    --
    id                              : UUID      <<PK>>  {not null, default: uuid_generate_v4()}
    parent_id                       : UUID      <<FK>>  {references isms_setting(id)}
}
ISMSS ||--o{ ISMSS : children
ISMSS ||--o{ APV : approvals

entity "document" as DOC {
    level                 : integer   {not null}
    name                  : string    {not null}
    created_time          : datetime  {not null, default: now() }
    version_group_id      : string    {not null}
    is_current            : bool      {not null, default: false}
    --
    id                    : UUID      <<PK>>  {not null, default: uuid_generate_v4()}
    uploadfile_entity_id  : UUID      <<FK>>  {nullable, references uploadfile_entity(id)}
    creator_id            : UUID      <<FK>>  {references user(id)}
    parent_id             : UUID      <<FK>>  {references document(id)}
}
DOC ||--o{ DOC : children
DOC ||--o{ APV : approvals

entity "threat" as THR {
    name                    : string     {not null}
    description             : text       {not null}
    value                   : float      {not null}
    type                    : enum CiaType    {not null}
    created_time            : datetime   {not null, default: now() }
    version_group_id        : string     {not null}
    is_current              : bool       {not null, default: false}
    --
    id                      : UUID       <<PK>> {not null, default: uuid_generate_v4()}
    parent_id               : UUID       <<FK>> {references threat(id)}
}
THR ||--o{ THR : children
THR ||--o{ APV : approvals

entity "vulnerability" as VUL {
    name                    : string     {not null}
    description             : text       {not null}
    value                   : float      {not null}
    type                    : enum CiaType {not null}
    created_time            : datetime   {not null, default: now() }
    version_group_id        : string     {not null}
    is_current              : bool       {not null, default: false}
    --
    id                      : UUID       <<PK>> {not null, default: uuid_generate_v4()}
    parent_id               : UUID       <<FK>> {references vulnerability(id)}
}
VUL ||--o{ VUL : children
VUL ||--o{ APV : approvals
@enduml
