@startuml
skinparam ParticipantPadding 12
skinparam BoxPadding 6

actor User as "一般使用者"
participant Frontend
participant "Asset API" as AssetAPI
participant "Approval API" as ApprovalAPI
participant "PendingOperations\nManager" as POM
participant Database
participant "RabbitMQ" as MQ

User -> Frontend: 確認並送出資產資料
Frontend -> AssetAPI: POST /api/isms/asset/
AssetAPI -> POM: publish_create_event(asset 暫存資料)
AssetAPI --> Frontend: 成功回應 (僅暫存事件)
Frontend -> ApprovalAPI: POST /api/system/approval/
ApprovalAPI -> POM: consume_event_and_get_domain(asset 暫存資料)
POM --> ApprovalAPI: 回傳 asset 暫存資料
ApprovalAPI -> Database: INSERT asset 暫存資料 (is_current = false)
ApprovalAPI -> Database: INSERT approval (final_status = pending)
ApprovalAPI -> MQ: 建立 pending_approval_queue_{approval_id}
ApprovalAPI --> Frontend: 回傳簽核單與待簽資訊
Frontend --> User: 顯示簽核已送出

@enduml