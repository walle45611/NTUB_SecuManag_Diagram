@startuml

actor User as "使用者"
participant Frontend
participant Backend
participant Database
participant Service as "風險計算服務"
participant Approval as "核准模組"

User ->> Frontend: 點擊「編輯資產設定」
Frontend ->> Backend: GET /api/system/asset-setting/
Backend ->> Database: 讀取 isms_setting、變數與自訂欄位設定
Backend -->> Frontend: 回傳設定資料
Frontend ->> Frontend: 顯示編輯表單 (名稱、描述、策略值、公式編輯器...)
User ->> Frontend: 修改並點擊「保存」
Frontend ->> Backend: POST /api/system/asset-setting/update-asset-setting/
Backend ->> Backend: 暫存設定更新至 Domain Event (不直接寫入資料庫)
Backend -->> Frontend: 回傳暫存成功訊息
Frontend ->> Backend: POST /api/system/approval/
note right of Backend: 資產設定更新暫存在 Domain Event 中\n等待核准完成後透過 Event Sourcing 進行：\n1. 實際更新 isms_setting 設定資料\n2. 觸發重新計算風險 (所有資產)\n3. 更新 risk 資料表
@enduml
