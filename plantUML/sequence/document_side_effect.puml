@startuml
autonumber
actor "使用者 (Signer)" as Signer
participant Frontend
participant Backend
queue RabbitMQ
participant Worker
database Database
participant "物件儲存\n(MinIO)" as ObjectStore
database "向量索引\n(pgvector)" as VectorStore

Signer -> Frontend: 核准文件變更
Frontend -> Backend: POST /api/approval/{approval_id}/user/{user_id}/approved
Backend -> RabbitMQ: publish approval.completed.approved (document payload)
Backend --> Frontend: 回傳成功

RabbitMQ -> Worker: deliver message
Worker -> Database: 更新文件版本與四階證明
Worker -> ObjectStore: 取得最新文件內容
Worker -> VectorStore: 重建文件向量索引
Worker -> Backend: 寄送通知
Worker -> RabbitMQ: 刪除 queue 並 ACK
@enduml
